#!/bin/bash

#Install extra fonts into the collabora docker module

OUTPUT=$(echo "$1" | tr -cd "a-z")
[ -z "$OUTPUT" ] && OUTPUT=normal

function show_progress_info {
if [ "$OUTPUT" = html ]
then
	echo '<ul><li>'"$MESSAGE"'</li></ul>'
else
	echo -e "\n$MESSAGE\n"
fi
}

#Get collabora container id
for i in $(seq 20)
do
	CONTAINER_ID=$(docker ps | grep "collabora/code" | cut -d" " -f1)
	[ ! -z "$CONTAINER_ID" ] && break
	MESSAGE=$"Waiting for Collabora"
	show_progress_info
	sleep 1
done

#Install extra fonts
if [ ! -z "$CONTAINER_ID" ]
then
	MESSAGE=$"Installing extra fonts"
	show_progress_info

	[ "$OUTPUT" = html ] && echo '<pre style="font-size: 10pt; font-family:Arial, Times, Georgia, serif">'
	docker exec "$CONTAINER_ID" apt-get -y install ttf-dejavu ttf-freefont fonts-nanum-coding fonts-cantarell ttf-bitstream-vera
	docker exec "$CONTAINER_ID" cp -fr /usr/share/fonts /opt/lool/systemplate/usr/share
	[ "$OUTPUT" = html ] && echo '</pre>'

	#Restart docker container to activate fonts
	MESSAGE=''$"Restarting docker container"' '"$CONTAINER_ID"''
	show_progress_info
	docker stop "$CONTAINER_ID" 1>/dev/null
	docker start "$CONTAINER_ID" 1>/dev/null
fi

