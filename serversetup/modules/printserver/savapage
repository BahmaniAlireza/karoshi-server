#!/bin/bash

SAVABINARY=savapage-setup-0.9.11-linux-x64.bin
INSTALLPATH=/opt/savapage

#Create savapage user
getent passwd savapage 1>/dev/null
if [ $? != 0 ]
then
	useradd -r savapage
fi

if [ ! -d "$INSTALLPATH" ]
then
	mkdir -p "$INSTALLPATH"
fi

chown savapage "$INSTALLPATH"

cd "$INSTALLPATH"
#Download savapage binary
if [ ! -f "$INSTALLPATH/$SAVABINARY" ]
then
	wget https://www.savapage.org/download/installer/savapage-setup-0.9.11-linux-x64.bin
fi

#Install Java JRE
#apt-get update
#apt-get install -y default-jre
#apt-get install -y default-jdk

#Run the installer
chown savapage "$INSTALLPATH/$SAVABINARY"
chmod 0755 "$INSTALLPATH/$SAVABINARY"
su savapage -c 'echo -e "yes\nno\n" | ./"'$SAVABINARY'"'

#Run root tasks
"$INSTALLPATH"/MUST-RUN-AS-ROOT

